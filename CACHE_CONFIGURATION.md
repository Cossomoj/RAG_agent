# Конфигурация кеширования в RAG Agent

## Текущая реализация: Вариант 2 - Глобальный кеш без очистки

### Описание
Кеш организован по структуре `cache_by_specialization[specialization][question_id] = answer` и накапливается для всех специализаций. При смене специализации пользователь автоматически получает ответы из кеша для новой специализации.

### Преимущества
- ✅ Максимальная производительность - ответы кешируются один раз для всех пользователей
- ✅ Простота - нет сложной логики очистки кеша
- ✅ Экономия ресурсов - RAG система не генерирует повторные ответы
- ✅ Автоматическое разделение по специализациям

### Недостатки
- ⚠️ Увеличенное потребление памяти
- ⚠️ Нет возможности обновить кешированные ответы без перезапуска

## Альтернатива: Вариант 1 - Кеш с очисткой при смене специализации

### Как переключиться на Вариант 1

1. **В файле `webapp/api/app.py`:**
   - Раскомментируйте строки 883-897 (блок очистки кеша)
   
2. **В файле `src/main_version/telegram_bot.py`:**
   - Раскомментируйте строки в обработчике `handle_role_specialization` (около строки 1490)
   - Раскомментируйте строки в обработчике онбординга (около строки 450)

3. **В файле `webapp/app.js`:**
   - Добавьте переменную `previousSpecialization` в AppState
   - Восстановите логику отслеживания предыдущей специализации
   - Передавайте `previousSpecialization` при сохранении профиля

### Преимущества Варианта 1
- ✅ Экономия памяти
- ✅ Возможность "обновить" кеш сменой специализации

### Недостатки Варианта 1
- ⚠️ Потеря производительности при частой смене специализаций
- ⚠️ Сложность реализации

## Рекомендации

- Используйте **Вариант 2** (текущий) для production окружения с большим количеством пользователей
- Используйте **Вариант 1** если память сервера ограничена
- Для полной очистки всего кеша используйте endpoint `/api/clear-cache`

## Структура кеша

```python
cache_by_specialization = {
    'Аналитик': {
        1: ['часть1', 'часть2', '...'],  # Ответ на вопрос 1
        2: ['часть1', 'часть2', '...'],  # Ответ на вопрос 2
        # ...
    },
    'Тестировщик': {
        1: ['часть1', 'часть2', '...'],
        2: ['часть1', 'часть2', '...'],
        # ...
    },
    # Другие специализации...
}
```

## API для управления кешем

- `POST /api/clear-cache` - очистить весь кеш
- `POST /clear-cache-specialization` - очистить кеш конкретной специализации (в телеграм-боте) 